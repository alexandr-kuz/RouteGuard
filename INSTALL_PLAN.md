# üìã RouteGuard ‚Äî –ü–æ–ª–Ω—ã–π –ø–ª–∞–Ω —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

> **–°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞:** –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (v0.1.0)
>
> –≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ—à–∞–≥–æ–≤—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–æ —Å–±–æ—Ä–∫–µ, —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ RouteGuard –Ω–∞ —Ä–æ—É—Ç–µ—Ä–µ Keenetic —Å Entware.

---

## üìñ –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è](#1-–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-–æ–∫—Ä—É–∂–µ–Ω–∏—è)
2. [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#2-–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
3. [–°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞](#3-—Å–±–æ—Ä–∫–∞-–ø—Ä–æ–µ–∫—Ç–∞)
4. [–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ä–æ—É—Ç–µ—Ä–∞](#4-–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-—Ä–æ—É—Ç–µ—Ä–∞)
5. [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ —Ä–æ—É—Ç–µ—Ä](#5-—É—Å—Ç–∞–Ω–æ–≤–∫–∞-–Ω–∞-—Ä–æ—É—Ç–µ—Ä)
6. [–ü–µ—Ä–≤–∏—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞](#6-–ø–µ—Ä–≤–∏—á–Ω–∞—è-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
7. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ VPN](#7-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-vpn)
8. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏](#8-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏)
9. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ DNS](#9-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-dns)
10. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ DPI –æ–±—Ö–æ–¥–∞](#10-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-dpi-–æ–±—Ö–æ–¥–∞)
11. [–§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞](#11-—Ñ–∏–Ω–∞–ª—å–Ω–∞—è-–ø—Ä–æ–≤–µ—Ä–∫–∞)
12. [–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º](#12-—Ä–µ—à–µ–Ω–∏–µ-–ø—Ä–æ–±–ª–µ–º)

---

## 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### 1.1. –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –í–µ—Ä—Å–∏—è | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|-----------|--------|------------|
| Go | 1.21+ | –î–ª—è —Å–±–æ—Ä–∫–∏ backend |
| Node.js | 18+ | –î–ª—è —Å–±–æ—Ä–∫–∏ frontend |
| npm | 9+ | –ú–µ–Ω–µ–¥–∂–µ—Ä –ø–∞–∫–µ—Ç–æ–≤ Node.js |
| Git | 2+ | –î–ª—è –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è |

### 1.2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (Windows)

```powershell
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —á–µ—Ä–µ–∑ winget
winget install GoLang.Go
winget install OpenJS.NodeJS.LTS
winget install Git.Git
```

–ò–ª–∏ —Å–∫–∞—á–∞–π—Ç–µ —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–∞–π—Ç–æ–≤:
- **Go:** https://go.dev/dl/
- **Node.js:** https://nodejs.org/
- **Git:** https://git-scm.com/

### 1.3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

```powershell
go version      # –æ–∂–∏–¥–∞–µ—Ç—Å—è: go version go1.21+
node --version  # –æ–∂–∏–¥–∞–µ—Ç—Å—è: v18+
npm --version   # –æ–∂–∏–¥–∞–µ—Ç—Å—è: 9+
git --version   # –æ–∂–∏–¥–∞–µ—Ç—Å—è: git version 2+
```

### 1.4. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

```powershell
# –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/alexandr-kuz/RouteGuard.git
cd RouteGuard
```

---

## 2. –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 2.1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–±–æ—Ä–∫–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```powershell
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç
make build

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é:
# Backend
cd backend
go mod download
go build -o ../dist/routeguard.exe ./main.go

# Frontend
cd ../frontend
npm install
npm run build
```

### 2.2. –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```powershell
# –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –∫–æ–Ω—Ñ–∏–≥ (—Å–º. —Ä–∞–∑–¥–µ–ª 6)
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
.\dist\routeguard.exe --config config.json

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É
curl http://localhost:8080/health
```

---

## 3. –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

### 3.1. –°–±–æ—Ä–∫–∞ Backend (Go)

```powershell
cd backend

# –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
go mod download

# –°–±–æ—Ä–∫–∞ –¥–ª—è Windows (–ª–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
go build -o ../dist/routeguard.exe ./main.go

# –°–±–æ—Ä–∫–∞ –¥–ª—è —Ä–æ—É—Ç–µ—Ä–∞ (Linux)
# –î–ª—è MIPS (Keenetic Start, Lite, Extra, Omni):
CGO_ENABLED=0 GOOS=linux GOARCH=mips \
    go build -ldflags="-s -w -extldflags '-static'" -trimpath \
    -o ../dist/routeguard-mips ./main.go

# –î–ª—è ARM (Keenetic Giga, Ultra, Pro):
CGO_ENABLED=0 GOOS=linux GOARCH=arm GOARM=7 \
    go build -ldflags="-s -w -extldflags '-static'" -trimpath \
    -o ../dist/routeguard-arm ./main.go

# –î–ª—è x86_64 (Keenetic –Ω–∞ Intel):
CGO_ENABLED=0 GOOS=linux GOARCH=amd64 \
    go build -ldflags="-s -w -extldflags '-static'" -trimpath \
    -o ../dist/routeguard-amd64 ./main.go
```

### 3.2. –°–±–æ—Ä–∫–∞ Frontend (Vue 3)

```powershell
cd frontend

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm install

# –°–±–æ—Ä–∫–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
npm run build

# –§–∞–π–ª—ã –ø–æ—è–≤—è—Ç—Å—è –≤ frontend/dist/
```

### 3.3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

```powershell
# –ü—Ä–æ–≤–µ—Ä–∫–∞ backend
dir dist
# –û–∂–∏–¥–∞–µ—Ç—Å—è:
# - routeguard.exe (Windows)
# - routeguard-mips (Linux MIPS)
# - routeguard-arm (Linux ARM)
# - routeguard-amd64 (Linux x86_64)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ frontend
dir frontend\dist
# –û–∂–∏–¥–∞–µ—Ç—Å—è:
# - index.html
# - assets/
```

---

## 4. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ä–æ—É—Ç–µ—Ä–∞

### 4.1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π

#### –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Ä–æ—É—Ç–µ—Ä—É –ø–æ SSH

```powershell
ssh admin@192.168.1.1
# –ü–∞—Ä–æ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: admin
```

#### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Entware

```bash
opkg --version
# –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: https://kb.keenetic.ru/hc/ru/articles/360000202345
```

#### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É

```bash
uname -m
# mips, mipsel ‚Äî MIPS
# armv7l, armv6l ‚Äî ARM  
# x86_64 ‚Äî Intel
```

#### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ—Å—É—Ä—Å—ã

```bash
free -m          # –°–≤–æ–±–æ–¥–Ω–∞—è RAM (—Ç—Ä–µ–±—É–µ—Ç—Å—è ‚â•50 MB)
df -h /opt       # –ú–µ—Å—Ç–æ –Ω–∞ /opt (—Ç—Ä–µ–±—É–µ—Ç—Å—è ‚â•100 MB)
```

### 4.2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤
opkg update

# –ë–∞–∑–æ–≤—ã–µ —É—Ç–∏–ª–∏—Ç—ã
opkg install curl wget openssl ca-certificates

# sing-box (VPN-—è–¥—Ä–æ)
opkg install sing-box

# smartdns (DNS-—Å–µ—Ä–≤–µ—Ä, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
opkg install smartdns

# ByeDPI (–æ–±—Ö–æ–¥ DPI, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
opkg install byedpi
```

---

## 5. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ —Ä–æ—É—Ç–µ—Ä

### 5.1. –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤

#### –ß–µ—Ä–µ–∑ WinSCP (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –°–∫–∞—á–∞–π—Ç–µ WinSCP: https://winscp.net/
2. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ `192.168.1.1` (–ª–æ–≥–∏–Ω: `admin`)
3. –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ:
   - `dist/routeguard-<arch>` ‚Üí `/tmp/routeguard`
   - `config.json` ‚Üí `/tmp/config.json`

#### –ß–µ—Ä–µ–∑ SCP

```powershell
# –î–ª—è MIPS
scp dist/routeguard-mips admin@192.168.1.1:/tmp/routeguard
scp config.json admin@192.168.1.1:/tmp/config.json
```

### 5.2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –ø–æ SSH
ssh admin@192.168.1.1

# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
mkdir -p /opt/etc/routeguard/{profiles,rulesets,certs}
mkdir -p /opt/var/log/routeguard
mkdir -p /opt/var/lib/routeguard/{geoip,geosite,backups}

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∏–Ω–∞—Ä–Ω–∏–∫–∞
cp /tmp/routeguard /opt/bin/routeguard
chmod +x /opt/bin/routeguard

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è API —Ç–æ–∫–µ–Ω–∞
API_TOKEN=$(openssl rand -hex 32)
echo "$API_TOKEN" > /opt/etc/routeguard/.api_token
chmod 600 /opt/etc/routeguard/.api_token

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥–∞
cp /tmp/config.json /opt/etc/routeguard/config.json
sed -i "s/test-token-change-in-production-abc123xyz789/$API_TOKEN/" /opt/etc/routeguard/config.json
```

### 5.3. –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞

```bash
cat > /opt/etc/init.d/S50rguard << 'EOF'
#!/bin/sh
NAME="routeguard"
BIN="/opt/bin/routeguard"
CONFIG="/opt/etc/routeguard/config.json"
PIDFILE="/var/run/$NAME.pid"

start() {
    echo "Starting $NAME..."
    start-stop-daemon -S -b -m -p $PIDFILE -x $BIN -- -config $CONFIG
}

stop() {
    echo "Stopping $NAME..."
    start-stop-daemon -K -p $PIDFILE
    rm -f $PIDFILE
}

restart() {
    stop
    sleep 1
    start
}

case "$1" in
    start) start ;;
    stop) stop ;;
    restart) restart ;;
    status)
        if pidof $NAME > /dev/null; then
            echo "$NAME is running"
        else
            echo "$NAME is stopped"
        fi
        ;;
    *) echo "Usage: $0 {start|stop|restart|status}" ;;
esac
EOF

chmod +x /opt/etc/init.d/S50rguard
```

### 5.4. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞

```bash
# –ó–∞–ø—É—Å–∫
/opt/etc/init.d/S50rguard start

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
/opt/etc/init.d/S50rguard status

# –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
ln -s /opt/etc/init.d/S50rguard /opt/etc/rc.d/S50rguard
```

---

## 6. –ü–µ—Ä–≤–∏—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 6.1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª

–°–æ–∑–¥–∞–π—Ç–µ `config.json` –≤ `/opt/etc/routeguard/`:

```json
{
    "version": "0.1.0",
    "installed_at": "2026-02-23T00:00:00Z",
    "api": {
        "host": "0.0.0.0",
        "port": 8080,
        "token": "<–í–ê–®_API_–¢–û–ö–ï–ù>",
        "cors": true,
        "allowed_origins": ["*"]
    },
    "vpn": {
        "enabled": true,
        "core": "sing-box",
        "config_dir": "/opt/etc/routeguard/profiles",
        "auto_connect": false
    },
    "routing": {
        "enabled": true,
        "mode": "domain",
        "default_route": "direct",
        "rulesets_dir": "/opt/etc/routeguard/rulesets"
    },
    "dns": {
        "enabled": true,
        "port": 53,
        "upstream": "tls://1.1.1.1",
        "bootstrap": "1.1.1.1",
        "cache_ttl": 300,
        "adblock": {
            "enabled": false,
            "lists": []
        }
    },
    "dpi": {
        "enabled": false,
        "mode": "auto",
        "bypass_domains": []
    },
    "logging": {
        "level": "info",
        "file": "/opt/var/log/routeguard/routeguard.log",
        "max_size_mb": 10,
        "max_backups": 3
    },
    "update": {
        "auto_check": false,
        "check_interval": "24h",
        "auto_install": false,
        "install_window": "03:00-05:00"
    },
    "security": {
        "rate_limit": 100,
        "session_timeout": "24h"
    }
}
```

### 6.2. –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤—Ö–æ–¥–∞

```bash
# API —Ç–æ–∫–µ–Ω
cat /opt/etc/routeguard/.api_token

# IP —Ä–æ—É—Ç–µ—Ä–∞
hostname -I | awk '{print $1}'
```

**–ó–∞–ø–∏—à–∏—Ç–µ:**
- **Web UI URL:** `http://<IP-—Ä–æ—É—Ç–µ—Ä–∞>:8080`
- **API –¢–æ–∫–µ–Ω:** `<–≤–∞—à-—Ç–æ–∫–µ–Ω>`

### 6.3. –ü–µ—Ä–≤—ã–π –≤—Ö–æ–¥

1. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ –∞–¥—Ä–µ—Å—É: `http://192.168.1.1:8080`
3. –í–≤–µ–¥–∏—Ç–µ API —Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `X-API-Token`

---

## 7. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ VPN

### 7.1. API endpoints

```bash
# –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø—Ä–æ—Ñ–∏–ª–µ–π
curl -H "X-API-Token: <—Ç–æ–∫–µ–Ω>" \
    http://192.168.1.1:8080/api/v1/vpn/profiles

# –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
curl -X POST -H "X-API-Token: <—Ç–æ–∫–µ–Ω>" \
    -H "Content-Type: application/json" \
    -d '{"name":"MyVPN","type":"wireguard","config":"..."}' \
    http://192.168.1.1:8080/api/v1/vpn/profiles

# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è
curl -X POST -H "X-API-Token: <—Ç–æ–∫–µ–Ω>" \
    http://192.168.1.1:8080/api/v1/vpn/profiles/<id>/connect

# –°—Ç–∞—Ç—É—Å
curl -H "X-API-Token: <—Ç–æ–∫–µ–Ω>" \
    http://192.168.1.1:8080/api/v1/vpn/status
```

### 7.2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```bash
# –í–Ω–µ—à–Ω–∏–π IP –¥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
curl ifconfig.me

# –ü–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –¥–æ–ª–∂–µ–Ω –∏–∑–º–µ–Ω–∏—Ç—å—Å—è
curl --proxy socks5h://localhost:1080 ifconfig.me
```

---

## 8. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏

### 8.1. API endpoints

```bash
# –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞
curl -H "X-API-Token: <—Ç–æ–∫–µ–Ω>" \
    http://192.168.1.1:8080/api/v1/routing/rules

# –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ
curl -X POST -H "X-API-Token: <—Ç–æ–∫–µ–Ω>" \
    -H "Content-Type: application/json" \
    -d '{
        "type": "domain",
        "domains": [".ru"],
        "action": "direct",
        "priority": 100,
        "enabled": true
    }' \
    http://192.168.1.1:8080/api/v1/routing/rules

# –û–±–Ω–æ–≤–∏—Ç—å GeoIP
curl -X POST -H "X-API-Token: <—Ç–æ–∫–µ–Ω>" \
    http://192.168.1.1:8080/api/v1/routing/geoip/update
```

### 8.2. –ü—Ä–∏–º–µ—Ä—ã –ø—Ä–∞–≤–∏–ª

| –¢–∏–ø | –î–æ–º–µ–Ω/IP | –î–µ–π—Å—Ç–≤–∏–µ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|-----|----------|----------|-----------|
| Domain | .ru | Direct | 100 |
| Domain | youtube.com, instagram.com | Proxy | 200 |
| Domain | .cn | Proxy | 100 |

---

## 9. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DNS

### 9.1. API endpoints

```bash
# –ü–æ–ª—É—á–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
curl -H "X-API-Token: <—Ç–æ–∫–µ–Ω>" \
    http://192.168.1.1:8080/api/v1/dns/settings

# –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
curl -X PUT -H "X-API-Token: <—Ç–æ–∫–µ–Ω>" \
    -H "Content-Type: application/json" \
    -d '{
        "upstream": "tls://1.1.1.1",
        "bootstrap": "1.1.1.1",
        "cache_ttl": 300
    }' \
    http://192.168.1.1:8080/api/v1/dns/settings

# –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à
curl -X POST -H "X-API-Token: <—Ç–æ–∫–µ–Ω>" \
    http://192.168.1.1:8080/api/v1/dns/cache/clear
```

### 9.2. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ä–µ–∫–ª–∞–º—ã

```bash
# –í–∫–ª—é—á–∏—Ç—å –∏ –¥–æ–±–∞–≤–∏—Ç—å —Å–ø–∏—Å–∫–∏
curl -X PUT -H "X-API-Token: <—Ç–æ–∫–µ–Ω>" \
    -H "Content-Type: application/json" \
    -d '{
        "adblock": {
            "enabled": true,
            "lists": [
                "https://adguardteam.github.io/AdGuardSDNSFilter/Filters/filter.txt",
                "https://easylist-downloads.adblockplus.org/easylist.txt"
            ]
        }
    }' \
    http://192.168.1.1:8080/api/v1/dns/settings
```

---

## 10. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DPI –æ–±—Ö–æ–¥–∞

### 10.1. API endpoints

```bash
# –ü–æ–ª—É—á–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
curl -H "X-API-Token: <—Ç–æ–∫–µ–Ω>" \
    http://192.168.1.1:8080/api/v1/dpi/settings

# –í–∫–ª—é—á–∏—Ç—å –æ–±—Ö–æ–¥
curl -X PUT -H "X-API-Token: <—Ç–æ–∫–µ–Ω>" \
    -H "Content-Type: application/json" \
    -d '{
        "enabled": true,
        "mode": "auto",
        "bypass_domains": ["youtube.com", "instagram.com"]
    }' \
    http://192.168.1.1:8080/api/v1/dpi/settings
```

---

## 11. –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

### 11.1. –ß–µ–∫-–ª–∏—Å—Ç

- [ ] –°–µ—Ä–≤–∏—Å –∑–∞–ø—É—â–µ–Ω: `/opt/etc/init.d/S50rguard status`
- [ ] API –¥–æ—Å—Ç—É–ø–µ–Ω: `curl http://192.168.1.1:8080/health`
- [ ] VPN –ø–æ–¥–∫–ª—é—á—ë–Ω: `/api/v1/vpn/status`
- [ ] DNS —Ä–∞–±–æ—Ç–∞–µ—Ç: `nslookup example.com 192.168.1.1`
- [ ] –õ–æ–≥–∏ –ø–∏—à—É—Ç—Å—è: `tail -f /opt/var/log/routeguard/routeguard.log`

### 11.2. –¢–µ—Å—Ç–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞
/opt/etc/init.d/S50rguard status

# –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
tail -f /opt/var/log/routeguard/routeguard.log

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤
netstat -tlnp | grep -E '8080|53'

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
ps | grep routeguard

# –¢–µ—Å—Ç API
curl http://192.168.1.1:8080/health
curl -H "X-API-Token: <—Ç–æ–∫–µ–Ω>" http://192.168.1.1:8080/api/v1/system/status
```

### 11.3. –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞

```bash
# –ë—ç–∫–∞–ø –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
tar -czf /tmp/routeguard-backup-$(date +%Y%m%d).tar.gz \
    /opt/etc/routeguard /opt/var/lib/routeguard

# –ß–µ—Ä–µ–∑ API
curl -X POST -H "X-API-Token: <—Ç–æ–∫–µ–Ω>" \
    http://192.168.1.1:8080/api/v1/system/backup
```

---

## 12. –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –°–µ—Ä–≤–∏—Å –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
cat /opt/var/log/routeguard/routeguard.log

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥–∞
cat /opt/etc/routeguard/config.json | jq .

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–∞
netstat -tlnp | grep 8080
# –ï—Å–ª–∏ –∑–∞–Ω—è—Ç ‚Äî –∏–∑–º–µ–Ω–∏—Ç–µ –ø–æ—Ä—Ç –≤ config.json
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: API –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞
ps | grep routeguard

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
/opt/etc/init.d/S50rguard restart

# –ü—Ä–æ–≤–µ—Ä–∫–∞ firewall
iptables -L -n | grep 8080
```

### –ü—Ä–æ–±–ª–µ–º–∞ 3: VPN –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ sing-box
sing-box version

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è
cat /opt/etc/routeguard/profiles/*.json

# –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
sing-box run -c /opt/etc/routeguard/profiles/<profile>.json
```

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –û—à–∏–±–∫–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∏–Ω–∞—Ä–Ω–∏–∫–∞
file /opt/bin/routeguard

# –î–æ–ª–∂–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å:
# MIPS: ELF 32-bit MSB executable, MIPS
# ARM: ELF 32-bit LSB executable, ARM
# x86: ELF 64-bit LSB executable, x86-64
```

### –ü—Ä–æ–±–ª–µ–º–∞ 5: –ú–∞–ª–æ –ø–∞–º—è—Ç–∏

```bash
# –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞
echo 3 > /proc/sys/vm/drop_caches

# –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤
rm /opt/var/log/routeguard/*.log.*

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞
reboot
```

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ —Ä–µ—Å—É—Ä—Å—ã

| –†–µ—Å—É—Ä—Å | –°—Å—ã–ª–∫–∞ |
|--------|--------|
| README | [README.md](README.md) |
| GitHub Issues | https://github.com/alexandr-kuz/RouteGuard/issues |
| Keenetic KB | https://kb.keenetic.ru/ |
| Entware | https://github.com/Entware/Entware |
| sing-box | https://sing-box.sagernet.org/ |

---

## üìù –ñ—É—Ä–Ω–∞–ª –∏–∑–º–µ–Ω–µ–Ω–∏–π

| –î–∞—Ç–∞ | –í–µ—Ä—Å–∏—è | –ò–∑–º–µ–Ω–µ–Ω–∏—è |
|------|--------|-----------|
| 2026-02-23 | 0.1.0 | –ê–∫—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ |
| 2024-01-01 | 0.1.0 | –ù–∞—á–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞ |

---

**RouteGuard** ¬© 2026. –°–¥–µ–ª–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞.
